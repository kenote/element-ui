"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var J=require("vue"),u=require("lodash"),A=require("@kenote/common"),X=require("rule-judgment");require("vue-router");var Z=require("js-yaml"),G=require("nunjucks");function j(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var P=j(J),S=j(X),x=j(Z),Q=j(G);/**
  * vue-class-component v7.2.6
  * (c) 2015-present Evan You
  * @license MIT
  */function O(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O=function(t){return typeof t}:O=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(e)}function ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e){return re(e)||ne(e)||ae()}function re(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function ne(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function ae(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ie(){return typeof Reflect!="undefined"&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function oe(e,t){k(e,t),Object.getOwnPropertyNames(t.prototype).forEach(function(r){k(e.prototype,t.prototype,r)}),Object.getOwnPropertyNames(t).forEach(function(r){k(e,t,r)})}function k(e,t,r){var n=r?Reflect.getOwnMetadataKeys(t,r):Reflect.getOwnMetadataKeys(t);n.forEach(function(a){var i=r?Reflect.getOwnMetadata(a,t,r):Reflect.getOwnMetadata(a,t);r?Reflect.defineMetadata(a,i,e,r):Reflect.defineMetadata(a,i,e)})}var se={__proto__:[]},le=se instanceof Array;function M(e){return function(t,r,n){var a=typeof t=="function"?t:t.constructor;a.__decorators__||(a.__decorators__=[]),typeof n!="number"&&(n=void 0),a.__decorators__.push(function(i){return e(i,r,n)})}}function ue(e){var t=O(e);return e==null||t!=="object"&&t!=="function"}function fe(e,t){var r=t.prototype._init;t.prototype._init=function(){var i=this,o=Object.getOwnPropertyNames(e);if(e.$options.props)for(var l in e.$options.props)e.hasOwnProperty(l)||o.push(l);o.forEach(function(s){Object.defineProperty(i,s,{get:function(){return e[s]},set:function(_){e[s]=_},configurable:!0})})};var n=new t;t.prototype._init=r;var a={};return Object.keys(n).forEach(function(i){n[i]!==void 0&&(a[i]=n[i])}),a}var F=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function H(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.name=t.name||e._componentTag||e.name;var r=e.prototype;Object.getOwnPropertyNames(r).forEach(function(l){if(l!=="constructor"){if(F.indexOf(l)>-1){t[l]=r[l];return}var s=Object.getOwnPropertyDescriptor(r,l);s.value!==void 0?typeof s.value=="function"?(t.methods||(t.methods={}))[l]=s.value:(t.mixins||(t.mixins=[])).push({data:function(){return ee({},l,s.value)}}):(s.get||s.set)&&((t.computed||(t.computed={}))[l]={get:s.get,set:s.set})}}),(t.mixins||(t.mixins=[])).push({data:function(){return fe(this,e)}});var n=e.__decorators__;n&&(n.forEach(function(l){return l(t)}),delete e.__decorators__);var a=Object.getPrototypeOf(e.prototype),i=a instanceof P.default?a.constructor:P.default,o=i.extend(t);return ce(o,e,i),ie()&&oe(o,e),o}var pe={prototype:!0,arguments:!0,callee:!0,caller:!0};function ce(e,t,r){Object.getOwnPropertyNames(t).forEach(function(n){if(!pe[n]){var a=Object.getOwnPropertyDescriptor(e,n);if(!(a&&!a.configurable)){var i=Object.getOwnPropertyDescriptor(t,n);if(!le){if(n==="cid")return;var o=Object.getOwnPropertyDescriptor(r,n);if(!ue(i.value)&&o&&o.value===i.value)return}Object.defineProperty(e,n,i)}}})}function N(e){return typeof e=="function"?H(e):function(t){return H(t,e)}}N.registerHooks=function(t){F.push.apply(F,te(t))};var z=globalThis&&globalThis.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),a=0,t=0;t<r;t++)for(var i=arguments[t],o=0,l=i.length;o<l;o++,a++)n[a]=i[o];return n},de=/\B([A-Z])/g,he=function(e){return e.replace(de,"-$1").toLowerCase()};function R(e){return function(t,r,n){var a=he(r),i=n.value;n.value=function(){for(var l=this,s=[],c=0;c<arguments.length;c++)s[c]=arguments[c];var _=function(y){var m=e||a;y===void 0?s.length===0?l.$emit(m):s.length===1?l.$emit(m,s[0]):l.$emit.apply(l,z([m],s)):(s.unshift(y),l.$emit.apply(l,z([m],s)))},v=i.apply(this,s);return ye(v)?v.then(_):_(v),v}}}function ye(e){return e instanceof Promise||e&&typeof e.then=="function"}function ge(e){return typeof e!="function"||!e.managed&&!e.managedReactive}function ve(e){var t=function(){var r=this,n=typeof e=="function"?e.call(this):e;n=Object.create(n||null),n[D]=Object.create(this[D]||{});for(var a in t.managed)n[t.managed[a]]=this[a];var i=function(l){n[t.managedReactive[l]]=o[l],Object.defineProperty(n[D],t.managedReactive[l],{enumerable:!0,configurable:!0,get:function(){return r[l]}})},o=this;for(var a in t.managedReactive)i(a);return n};return t.managed={},t.managedReactive={},t}var D="__reactiveInject__";function _e(e){Array.isArray(e.inject)||(e.inject=e.inject||{},e.inject[D]={from:D,default:{}})}var me=typeof Reflect!="undefined"&&typeof Reflect.getMetadata!="undefined";function Y(e,t,r){if(me&&!Array.isArray(e)&&typeof e!="function"&&!e.hasOwnProperty("type")&&typeof e.type=="undefined"){var n=Reflect.getMetadata("design:type",t,r);n!==Object&&(e.type=n)}}function we(e,t){return t===void 0&&(t={}),function(r,n){Y(t,r,n),M(function(a,i){(a.props||(a.props={}))[i]=t,a.model={prop:i,event:e||i}})(r,n)}}function h(e){return e===void 0&&(e={}),function(t,r){Y(e,t,r),M(function(n,a){(n.props||(n.props={}))[a]=e})(t,r)}}function $(e){return M(function(t,r){var n=t.provide;_e(t),ge(n)&&(n=t.provide=ve(n)),n.managed[r]=e||r})}function C(e,t){t===void 0&&(t={});var r=t.deep,n=r===void 0?!1:r,a=t.immediate,i=a===void 0?!1:a;return M(function(o,l){typeof o.watch!="object"&&(o.watch=Object.create(null));var s=o.watch;typeof s[e]=="object"&&!Array.isArray(s[e])?s[e]=[s[e]]:typeof s[e]=="undefined"&&(s[e]=[]),s[e].push({handler:l,deep:n,immediate:i})})}var be=Object.defineProperty,De=Object.getOwnPropertyDescriptor,g=(e,t,r,n)=>{for(var a=n>1?void 0:n?De(t,r):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(a=(n?o(t,r,a):o(a))||a);return n&&a&&be(t,r,a),a};let d=class extends P.default{constructor(){super(...arguments),this.styles={},this.timestamp=0}onWidthChange(e,t){e!==t&&this.getStyles(e)}onVisibleChange(e,t){e!==t&&(e?(document.addEventListener("click",this.handleClick,!0),this.styles=u.merge(this.styles,{[this.placement]:"0"}),this.timestamp=Date.now(),this.$emit("open",null)):(document.removeEventListener("click",this.handleClick,!1),this.styles=u.merge(this.styles,{[this.placement]:`-${this.width}${this.unit}`})))}handleClick(e){var n,a,i;if(this.lock)return;let t=(n=this.$refs)==null?void 0:n.drawer;if(!u.compact((a=u.get(e,"path"))==null?void 0:a.map(o=>o.className)).includes((i=t==null?void 0:t.className)!=null?i:"")){if(Date.now()-this.timestamp<10)return;this.visible&&this.$emit("close",null)}}getStyles(e){let t=["top","bottom"].includes(this.placement)?"height":"width",r={};["left","right"].includes(this.placement)&&(r.top=`${this.offset}${this.unit}`),this.zIndex&&(r["z-index"]=this.zIndex),this.styles=u.merge({[t]:`${e}${this.unit}`,[this.placement]:`-${e}${this.unit}`},r)}};g([h({default:"right"})],d.prototype,"placement",2);g([h({default:360})],d.prototype,"width",2);g([h({default:!1})],d.prototype,"visible",2);g([h({default:!1})],d.prototype,"lock",2);g([h({default:void 0})],d.prototype,"zIndex",2);g([h({default:"px"})],d.prototype,"unit",2);g([h({default:0})],d.prototype,"offset",2);g([$()],d.prototype,"styles",2);g([$()],d.prototype,"timestamp",2);g([C("width")],d.prototype,"onWidthChange",1);g([C("visible")],d.prototype,"onVisibleChange",1);d=g([N({name:"KlDrawer",created(){this.getStyles(this.width)}})],d);var $e=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"drawer",staticClass:"kl-drawer",class:e.placement,style:e.styles},[e._t("header"),e._t("default"),e._t("footer")],2)},Ce=[];function W(e,t,r,n,a,i,o,l){var s=typeof e=="function"?e.options:e;t&&(s.render=t,s.staticRenderFns=r,s._compiled=!0),n&&(s.functional=!0),i&&(s._scopeId="data-v-"+i);var c;if(o?(c=function(y){y=y||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!y&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(y=__VUE_SSR_CONTEXT__),a&&a.call(this,y),y&&y._registeredComponents&&y._registeredComponents.add(o)},s._ssrRegister=c):a&&(c=l?function(){a.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:a),c)if(s.functional){s._injectStyles=c;var _=s.render;s.render=function(m,q){return c.call(q),_(m,q)}}else{var v=s.beforeCreate;s.beforeCreate=v?[].concat(v,c):[c]}return{exports:e,options:s}}const I={};var Oe=W(d,$e,Ce,!1,Pe,null,null,null);function Pe(e){for(let t in I)this[t]=I[t]}var B=function(){return Oe.exports}(),je=Object.defineProperty,Se=Object.getOwnPropertyDescriptor,p=(e,t,r,n)=>{for(var a=n>1?void 0:n?Se(t,r):t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(a=(n?o(t,r,a):o(a))||a);return n&&a&&je(t,r,a),a};let f=class extends P.default{constructor(){super(...arguments),this.keywords="",this.restaurants=[]}onKeywordsChange(e,t){e!==t&&this.update(e)}onValueChange(e,t){e!==t&&(this.keywords=e)}onDataChange(e,t){e!==t&&(this.restaurants=A.initMaps(e))}update(e){}handleCommand(e){}handleFocus(e){}handleBlur(e){}querySearch(e,t){let r=[];T(this.restaurants,u.trim(e),r),this.filter&&(r=r.filter(S.default(this.filter)));let n=u.assign({value:"name",key:"key",description:"description",maps:"maps"},this.props);t(r.map(U(n)))}handleClear(){var t;this.keywords="";let e=(t=this.$refs)==null?void 0:t.searchbar;setTimeout(()=>{e.focus()},300)}keyWordsString(e){var r;let t=u.trim(this.keywords);return(r=e.name)==null?void 0:r.replace(new RegExp(`(${t})`,"gi"),"<span class='keywords'>$1</span>")}handleSelect(e){this.handleCommand(e),this.handleClear()}};p([$()],f.prototype,"item",2);p([h({default:"\u641C\u7D22\u5185\u5BB9"})],f.prototype,"placeholder",2);p([h({default:void 0})],f.prototype,"data",2);p([h({default:void 0})],f.prototype,"props",2);p([h({default:void 0})],f.prototype,"filter",2);p([h({default:"searchbar-popper"})],f.prototype,"popperClass",2);p([h({default:"default"})],f.prototype,"size",2);p([$()],f.prototype,"keywords",2);p([$()],f.prototype,"restaurants",2);p([we("update")],f.prototype,"value",2);p([C("keywords")],f.prototype,"onKeywordsChange",1);p([C("value")],f.prototype,"onValueChange",1);p([C("data")],f.prototype,"onDataChange",1);p([R("update")],f.prototype,"update",1);p([R("command")],f.prototype,"handleCommand",1);p([R("focus")],f.prototype,"handleFocus",1);p([R("blur")],f.prototype,"handleBlur",1);f=p([N({name:"KlChannelSearchbar",mounted(){var e;this.keywords=this.value,this.restaurants=A.initMaps((e=this.data)!=null?e:[])}})],f);var xe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-autocomplete",{ref:"searchbar",attrs:{size:e.size,"prefix-icon":"el-icon-search","popper-class":e.popperClass,placeholder:e.placeholder,"fetch-suggestions":e.querySearch},on:{focus:e.handleFocus,blur:e.handleBlur,select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.item;return r("div",{},[a.maps?r("div",{staticClass:"name"},e._l(a.maps,function(i,o){return r("fragment",{key:o},[[o>0?r("span",[e._v(" > ")]):e._e(),r("span",{domProps:{innerHTML:e._s(e.keyWordsString(i))}})]],2)}),1):r("div",{staticClass:"name"},[e._v(e._s(a.name))]),a.description?r("span",{staticClass:"description"},[e._v(e._s(a.description))]):e._e()])}}]),model:{value:e.keywords,callback:function(n){e.keywords=n},expression:"keywords"}},[r("i",{directives:[{name:"show",rawName:"v-show",value:e.keywords,expression:"keywords"}],staticClass:"el-icon-error el-input__icon",attrs:{slot:"suffix"},on:{click:e.handleClear},slot:"suffix"})])},Me=[];const L={};var Re=W(f,xe,Me,!1,ke,null,null,null);function ke(e){for(let t in L)this[t]=L[t]}var V=function(){return Re.exports}(),Fe=Object.freeze(Object.defineProperty({__proto__:null,Drawer:B,ChannelSearchbar:V},Symbol.toStringTag,{value:"Module"}));function K(e,t){if(!e)return null;let r=u.compact(["dialog","action","command","router","https?",t]).join("|"),n=new RegExp(`^(${r})\\:(\\S+)$`),a=e.match(n);if(!a)return null;let[,i,o]=a;return/^(https?)/.test(i)?{type:"http",path:e}:{type:i,path:o}}function Ee(e,t){return(r,n,a)=>{let i=K(r);if(!!i){if(i.type==="command"){let[o,...l]=i.path.split("|"),s=u.get(t!=null?t:e,o);u.isFunction(s)&&s(...l)}else if(i.type==="action")t!=null&&t.action&&(t==null||t.action(i.path,n,a,e));else if(i.type==="dialog")t!=null&&t.dialog&&(t==null||t.dialog(i.path,n,a,e));else if(i.type==="router"){if(!(e!=null&&e.$router))return;e.$router.push(i.path)}else if(i.type==="http"){if(!document)return;let o=document.createElement("a"),[l,s]=i.path.split("|");o.href=l,s&&(o.target=s),o.click()}}}}function T(e,t,r=[]){if(!t)return;let n=u.map(r,"key"),a={$or:[{name:{$regex:new RegExp(t,"i")}},{keywords:{$_in:[t.toLocaleLowerCase()]}}]},i=A.dataNodeProxy(e).find({$and:[{key:{$nin:n}},a,{children:{$exists:!1}}]});i&&(r.push(i),T(e,t,r))}function Ae(e){return(t,r)=>{if(!t)return!1;let n=t,a=u.assign({},e,r);return u.isString(t)&&(n=x.default.safeLoad(b(t,a)),!u.isPlainObject(n))?!1:u.isBoolean(n)?n:S.default(n)(a)}}function Ne(e){return(t,r)=>{if(!t)return!0;let n=t,a=u.assign({},e,r);return u.isString(t)&&(n=x.default.safeLoad(b(t,a)),!u.isPlainObject(n))?!0:S.default(n)(a)}}function Te(e,t={}){if(!e)return n=>!0;let r=e;return u.isString(e)&&(r=x.default.safeLoad(b(e,{...t}))),u.isPlainObject(r)?S.default(r):n=>!0}function qe(e,t={}){if(!e)return null;let r=e;return u.isString(e)&&(r=x.default.safeLoad(b(e,{...t}))),u.isPlainObject(r)?r:null}function b(e,t){let r=new Q.default.Environment(null,{autoescape:!1});return r.addFilter(w.name,n=>String(w(n))),r.addFilter(E.name,n=>String.raw`${E(n,t)}`),r.renderString(e,t)}function w(e,t){if(u.isDate(e))return e;if(/(\_)/.test(e)){let i=e.split(/\_/),o=null;for(let l of i){if(o&&!/(day?(s|e)|week?(s|e))$/.test(l))break;o=w(l,o)}return o}let r=He(e),n=t!=null?t:new Date,a=n.getDay()-1;if(e==="now")return new Date;if(["yesterday","today","tomorrow"].includes(e)){let i=["yesterday","today","tomorrow"].indexOf(e)-1;return w([i,"days"].join(" "))}else{if(/(day)$/.test(e))return new Date(n.setDate(n.getDate()+r));if(/(days)$/.test(e))return new Date(new Date(n.setDate(n.getDate()+r)).setHours(0,0,0,0));if(/(daye)$/.test(e))return new Date(new Date(n.setDate(n.getDate()+r)).setHours(23,59,59,999));if(/(week)$/.test(e)){let i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-a+r*7+a).setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds());return new Date(i)}else{if(/(weeks)$/.test(e))return new Date(n.getFullYear(),n.getMonth(),n.getDate()-a+r*7+0);if(/(weeke)$/.test(e)){let i=new Date(n.getFullYear(),n.getMonth(),n.getDate()-a+r*7+6).setHours(23,59,59,999);return new Date(i)}else{if(/(month)$/.test(e))return new Date(new Date(new Date().setMonth(r)));if(/(months)$/.test(e))return new Date(new Date(new Date().setMonth(r,1)).setHours(0,0,0,0));if(/(monthe)$/.test(e)){let i=r-new Date().getMonth()+1;return new Date(w(`${i} months`).getTime()-1)}else{if(/(year)$/.test(e))return new Date(new Date().setFullYear(r));if(/(years)$/.test(e))return new Date(new Date(new Date().setFullYear(r,0,1)).setHours(0,0,0,0));if(/(yeare)$/.test(e))return new Date(new Date(new Date().setFullYear(r,11,31)).setHours(23,59,59,999))}}}}return null}function E(e,t){return u.get(t,e,"").split(`
`).join(`

`).replace(/\"/g,'\\"')}function U(e){return t=>{if(!e)return t;let r=t,n=[];for(let[a,i]of Object.entries(e))r[a]=/(\{)/.test(i)?b(i,t):u.get(t,i),a!==i&&n.push(i);return u.omit(r,n)}}function He(e){var i,o;let[t]=e.split(/\s+/),[r]=(i=e.match(/(year|month|day|week)/))!=null?i:[],n={day:0,month:new Date().getMonth(),year:new Date().getFullYear()},a=(o=n==null?void 0:n[r])!=null?o:0;return/(\d+){4}/.test(t)?a=Number(t):u.isNaN(Number(t))||(a+=Number(t)),a}const ze={install:e=>{for(let[,t]of Object.entries(Fe))e.component(`${t.name}`,t)}};exports.ChannelSearchbar=V;exports.Drawer=B;exports.Plugin=ze;exports.filterChannelDataNode=T;exports.getConditions=qe;exports.getFilter=Te;exports.isDisabled=Ae;exports.isFilter=Ne;exports.parseCommand=K;exports.parseContent=E;exports.parseDate=w;exports.parseProps=U;exports.parseTemplate=b;exports.runCommand=Ee;
